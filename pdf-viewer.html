<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; object-src 'self' blob: data:; frame-src 'self' blob: data:; base-uri 'self'">
  <title>Visor PDF</title>
  <style>
    html, body { height: 100%; margin: 0; background: #111; }
    #fallback { position: absolute; inset: 0; display: none; color: #fff; padding: 1rem; }
    embed, iframe { width: 100%; height: 100%; border: 0; }
  </style>
  <script>
    (function(){
      let mounted = false;
      function mountWithUrl(url){
        if (mounted) return; mounted = true;
        const emb = document.createElement('embed');
        emb.type = 'application/pdf';
        emb.src = url;
        document.body.appendChild(emb);
      }
      function mountWithDataUrl(dataUrl){
        if (mounted) return; mounted = true;
        const emb = document.createElement('embed');
        emb.type = 'application/pdf';
        emb.src = dataUrl;
        document.body.appendChild(emb);
      }
      window.addEventListener('message', (ev) => {
        try {
          const d = ev.data || {};
          if (d && d.type === 'OPEN_PDF_URL' && typeof d.url === 'string') {
            mountWithUrl(d.url); return;
          }
          if (d && d.type === 'OPEN_PDF_DATA' && typeof d.dataUrl === 'string') {
            mountWithDataUrl(d.dataUrl); return;
          }
          if (d && d.type === 'OPEN_PDF_BLOB' && d.blob) {
            const url = URL.createObjectURL(d.blob);
            mountWithUrl(url); return;
          }
        } catch (_) {}
      });
      // Señal para el opener (opcional)
      try { window.opener && window.opener.postMessage({ type: 'PDF_VIEWER_READY' }, '*'); } catch (_) {}
      // Fallback si nadie nos manda nada
      setTimeout(() => {
        if (!mounted) {
          const el = document.getElementById('fallback');
          el.style.display = 'block';
          el.textContent = 'No se recibió el PDF. Cierra esta pestaña e inténtalo de nuevo.';
        }
      }, 4000);
    })();
  </script>
  </head>
  <body>
    <div id="fallback">Cargando…</div>
  </body>
</html>

